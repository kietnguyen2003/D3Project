<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trực quan hóa dữ liệu</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="container">
    <div class="idiom" id="i1">
      <h1 class="title">1. Brand nhận được sự quan tâm của mọi người</h1>
      <div class="filter">
        <label>Filter by Classification:</label>
        <div id="classificationFilter">
          <label><input type="checkbox" value="All" checked> All</label><br>
          <label><input type="checkbox" value="High popularity and highly rated"> High popularity and highly
            rated</label><br>
          <label><input type="checkbox" value="High popularity and moderate ratings"> High popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Medium popularity and highly rated"> Medium popularity and highly
            rated</label><br>
          <label><input type="checkbox" value="Medium popularity and moderate ratings"> Medium popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Low popularity and low ratings"> Low popularity and low
            ratings</label><br>
          <label><input type="checkbox" value="Lower popularity and moderate ratings"> Lower popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Lower popularity but highly rated"> Lower popularity but highly
            rated</label><br>
          <label><input type="checkbox" value="High popularity but low ratings"> High popularity but low
            ratings</label><br>
        </div>
      </div>

      <div class="chart" id="chart1">
      </div>
      <div class="comment" id="comment1">
        <label for="nhanxet">Nhận xét 1 </label>
        <div class="nhanxet"> Dựa trên dữ liệu, Apple là thương hiệu được quan tâm nhất với lượng đánh giá (Rating) cao
          nhất là 5,689,393 và 276,380 lượt đánh giá chi tiết (Reviews), tiếp theo là vivo với 4,530,263 Rating và
          264,831 Reviews, chứng tỏ sức hút lớn của hai thương hiệu này. Motorola, realme, và SAMSUNG cũng nhận được sự
          chú ý đáng kể, đặc biệt ở phân khúc tầm trung. Trong khi đó, các thương hiệu như Google, LAVA, và itel có mức
          độ quan tâm trung bình, chủ yếu nhắm vào thị trường khác. Tuy nhiên, một số thương hiệu như I, Vox, và
          KARBONN hầu như không được biết đến, với số lượt đánh giá và bình luận rất thấp, cho thấy mức độ phổ biến gần
          như không có.</div>
      </div>
    </div>
    <div class="idiom" id="i2">
      <div class="chart" id="chart2"></div>
      <div class="comment" id="comment2">
        <label for="nhanxet">Nhận xét 2 </label>
        <div class="nhanxet"></div>
      </div>
    </div>
    <div class="idiom" id="i3">
      <div class="chart" id="chart3"></div>
      <div class="comment" id="comment3">
        <label for="nhanxet">Nhận xét 3 </label>
        <div class="nhanxet"></div>
      </div>
    </div>
    <div class="idiom" id="i4">
      <div class="chart" id="chart4"></div>
      <div class="comment" id="comment4">
        <label for="nhanxet">Nhận xét 4 </label>
        <div class="nhanxet"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import {
      processCSVWithD3,
      test
    } from './index.js';

    const data = await processCSVWithD3('chart_with_classification.csv');

    test(data, "#chart1");

    document.querySelectorAll('#classificationFilter input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const allCheckbox = document.querySelector('#classificationFilter input[value="All"]');
        const otherCheckboxes = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:not([value="All"])'));

        // Lấy danh sách các classification đã tick
        const selectedClassifications = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // Nếu "All" được tick, bỏ tick tất cả các ô khác
        if (checkbox.value === "All" && checkbox.checked) {
          otherCheckboxes.forEach(cb => cb.checked = false);
        }

        // Nếu checkbox khác được tick, bỏ tick "All"
        else if (selectedClassifications.length > 0 && selectedClassifications.includes(checkbox.value)) {
          allCheckbox.checked = false;
        }

        // Nếu không checkbox nào được chọn, tự động bật "All"
        if (selectedClassifications.length === 0) {
          allCheckbox.checked = true;
        }

        // Lấy lại danh sách classification đã tick (sau khi cập nhật trạng thái checkbox)
        const updatedClassifications = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // Lọc dữ liệu dựa trên danh sách classification đã chọn
        const filteredData = updatedClassifications.includes("All") ? data : data.filter(d => updatedClassifications.includes(d.classification));

        // Xóa biểu đồ cũ
        // Chỉ xóa các phần tử biểu đồ bên trong chart1, không xóa filter
        d3.select("#chart1")
          .selectAll("*") // Đảm bảo chỉ xóa các phần tử được vẽ bởi D3
          .remove();

        // Vẽ lại biểu đồ với dữ liệu đã lọc
        test(filteredData, "#chart1");
      });
    });


  </script>


</body>

</html>"