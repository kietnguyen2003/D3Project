<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trực quan hóa dữ liệu</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="container">
    <div class="idiom" id="i1">
      <h1 class="title">1. Brand nhận được sự quan tâm của mọi người</h1>
      <div class="filter">
        <label>Filter by Classification:</label>
        <div id="classificationFilter">
          <label><input type="checkbox" value="All" checked> All</label><br>
          <label><input type="checkbox" value="High popularity and highly rated"> High popularity and highly
            rated</label><br>
          <label><input type="checkbox" value="High popularity and moderate ratings"> High popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Medium popularity and highly rated"> Medium popularity and highly
            rated</label><br>
          <label><input type="checkbox" value="Medium popularity and moderate ratings"> Medium popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Low popularity and low ratings"> Low popularity and low
            ratings</label><br>
          <label><input type="checkbox" value="Lower popularity and moderate ratings"> Lower popularity and
            moderate ratings</label><br>
          <label><input type="checkbox" value="Lower popularity but highly rated"> Lower popularity but highly
            rated</label><br>
          <label><input type="checkbox" value="High popularity but low ratings"> High popularity but low
            ratings</label><br>
        </div>
      </div>

      <div class="chart" id="chart1">
      </div>
      <div class="comment" id="comment1">
        <label for="nhanxet">Nhận xét 1 </label>
        <div class="nhanxet"> Dựa trên dữ liệu, Apple là thương hiệu được quan tâm nhất với lượng đánh giá (Rating) cao
          nhất là 5,689,393 và 276,380 lượt đánh giá chi tiết (Reviews), tiếp theo là vivo với 4,530,263 Rating và
          264,831 Reviews, chứng tỏ sức hút lớn của hai thương hiệu này. Motorola, realme, và SAMSUNG cũng nhận được sự
          chú ý đáng kể, đặc biệt ở phân khúc tầm trung. Trong khi đó, các thương hiệu như Google, LAVA, và itel có mức
          độ quan tâm trung bình, chủ yếu nhắm vào thị trường khác. Tuy nhiên, một số thương hiệu như I, Vox, và
          KARBONN hầu như không được biết đến, với số lượt đánh giá và bình luận rất thấp, cho thấy mức độ phổ biến gần
          như không có.</div>
      </div>
    </div>
    <div class="idiom" id="i2">
      <h1 class="title">2. Cấu hình điện thoại được sản xuất nhiều (RAM (GB), Storage (GB))</h1>
      <div class="chart" id="chart2"></div>
      <div class="comment" id="comment2">
        <label for="nhanxet">Nhận xét 2 </label>
        <div class="nhanxet">Dữ liệu cho thấy các sản phẩm có cấu hình cao hơn như RAM từ 8GB trở lên và dung lượng lưu
          trữ lớn (256GB hoặc 512GB) thường có giá trung bình cao hơn và nhận được nhiều đánh giá hơn, điều này phản ánh
          sự ưu tiên của người dùng đối với các thiết bị cao cấp. Tuy nhiên, số lượng sản phẩm lớn nhất lại tập trung ở
          các cấu hình trung bình như 4GB hoặc 6GB RAM với 128GB lưu trữ, cho thấy đây là phân khúc phổ biến được các
          nhà sản xuất tối ưu hóa. Cấu hình thấp hơn như 0GB RAM và lưu trữ nhỏ hơn 32GB không chỉ có giá thấp mà còn ít
          nhận được sự quan tâm và đánh giá từ người dùng, thể hiện xu hướng tập trung vào hiệu năng và trải nghiệm tốt
          hơn trong phân khúc cao hơn.</div>
      </div>
    </div>
    <div class="idiom" id="i3">
      <h1 class="title">3. So sánh giá cả trung bình giữa các phân loại nhãn dán</h1>
      <div class="chart" id="chart3"></div>
      <div class="comment" id="comment3">
        <label for="nhanxet">Nhận xét 3 </label>
        <div class="nhanxet">Dựa trên dữ liệu, các sản phẩm có độ phổ biến cao và đánh giá tốt thường có giá trị thực tế
          cao và mức giảm giá ít (ví dụ: "High popularity and highly rated" với giá 54,355.42). Ngược lại, các sản phẩm
          đánh giá thấp nhưng phổ biến cao có giá trị thực tế thấp và mức giảm giá lớn. Các sản phẩm đánh giá cao nhưng
          ít phổ biến có giá trị thực tế cao nhưng giảm giá mạnh, trong khi các sản phẩm đánh giá thấp và phổ biến trung
          bình có giá thấp và ít giảm giá. Nhìn chung, giá cả phản ánh sự kết hợp giữa độ phổ biến và chất lượng của sản
          phẩm.</div>
      </div>
    </div>
    <div class="idiom" id="i4">
      <h1 class="title">4. Phân phối kích thước màn hình phổ biến của từng thương hiệu</h1>
      <div class="options">
        <label for="brand">Chọn thương hiệu:</label>
        <select name="brand" id="brandSelect">
          <option value="Apple">Apple</option>
          <option value="vivo">vivo</option>
          <option value="Motorola">Motorola</option>
          <option value="realme">realme</option>
          <option value="SAMSUNG">SAMSUNG</option>
          <option value="Google">Google</option>
          <option value="LAVA">LAVA</option>
          <option value="itel">itel</option>
          <option value="I">I</option>
          <option value="Vox">Vox</option>
          <option value="KARBONN">KARBONN</option>
        </select>
      </div>
      <div class="chart" id="chart4">
      </div>
      <div class="comment" id="comment4">
        <label for="nhanxet">Nhận xét 4 </label>
        <div class="nhanxet">Dựa trên dữ liệu, các thương hiệu lớn như Apple, Samsung, OPPO, Redmi, POCO và Realme chủ
          yếu cung cấp sản phẩm với kích thước màn hình từ 6.5 inch đến 6.7 inch, đây là các kích thước phổ biến trên
          thị trường. Ví dụ, Samsung có nhiều sản phẩm với 6.5 inch và 6.6 inch, trong khi Redmi và POCO chủ yếu có 6.67
          inch và 6.74 inch. Các thương hiệu nhỏ như Kechaoda và I lại tập trung vào các kích thước nhỏ hơn như 1.77
          inch và 2.4 inch. Nhìn chung, các thương hiệu lớn chọn kích thước màn hình vừa và lớn, trong khi các thương
          hiệu nhỏ nhắm đến nhu cầu điện thoại cơ bản.</div>
      </div>
    </div>
  </div>

  <script type="module">
    import {
      processCSVWithD3,
      test
    } from './js/chart1.js';

    import {
      process2CSVWithD3,
      renderProductCountHeatmap,

    } from './js/chart2.js';

    import {
      process3CSVWithD3,
      test3
    } from './js/chart3.js';

    import {
      process4CSVWithD3,
      drawTreemap
    } from './js/chart4.js';


    //Chart1
    const data = await processCSVWithD3('../csv/chart1_with_classification.csv');
    const data2 = await process2CSVWithD3('../csv/chart2_with_config.csv');
    const data3 = await process3CSVWithD3('../csv/chart3_with_avg_values.csv');
    const data4 = await process4CSVWithD3('../csv/chart4_with_brand_display_counts.csv');

    test(data, "#chart1");
    renderProductCountHeatmap(data2, "#chart2");
    test3(data3, "#chart3");
    drawTreemap(data4, "#chart4", "Apple");



    document.querySelectorAll('#classificationFilter input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const allCheckbox = document.querySelector('#classificationFilter input[value="All"]');
        const otherCheckboxes = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:not([value="All"])'));

        // Lấy danh sách các classification đã tick
        const selectedClassifications = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // Nếu "All" được tick, bỏ tick tất cả các ô khác
        if (checkbox.value === "All" && checkbox.checked) {
          otherCheckboxes.forEach(cb => cb.checked = false);
        }

        // Nếu checkbox khác được tick, bỏ tick "All"
        else if (selectedClassifications.length > 0 && selectedClassifications.includes(checkbox.value)) {
          allCheckbox.checked = false;
        }

        // Nếu không checkbox nào được chọn, tự động bật "All"
        if (selectedClassifications.length === 0) {
          allCheckbox.checked = true;
        }

        // Lấy lại danh sách classification đã tick (sau khi cập nhật trạng thái checkbox)
        const updatedClassifications = Array.from(document.querySelectorAll('#classificationFilter input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // Lọc dữ liệu dựa trên danh sách classification đã chọn
        const filteredData = updatedClassifications.includes("All") ? data : data.filter(d => updatedClassifications.includes(d.classification));

        // Xóa biểu đồ cũ
        // Chỉ xóa các phần tử biểu đồ bên trong chart1, không xóa filter
        d3.select("#chart1")
          .selectAll("*") // Đảm bảo chỉ xóa các phần tử được vẽ bởi D3
          .remove();

        // Vẽ lại biểu đồ với dữ liệu đã lọc
        test(filteredData, "#chart1");
      });


      // Chart2
    });

    // Lấy danh sách các thương hiệu duy nhất từ data4
    const uniqueBrands = [...new Set(data4.map(d => d.brand))];

    // Tham chiếu đến dropdown menu
    const brandSelect = document.getElementById('brandSelect');

    // Xóa tất cả các options cũ (nếu có)
    brandSelect.innerHTML = "";

    // Thêm các options vào dropdown dựa trên danh sách thương hiệu duy nhất
    uniqueBrands.forEach(brand => {
      const option = document.createElement('option');
      option.value = brand;
      option.textContent = brand;
      brandSelect.appendChild(option);
    });

    // Thêm sự kiện lắng nghe khi chọn một thương hiệu từ dropdown
    brandSelect.addEventListener('change', (event) => {
      const selectedBrand = event.target.value;

      // Xóa biểu đồ cũ
      d3.select("#chart4").selectAll("*").remove();

      // Vẽ lại biểu đồ TreeMap với thương hiệu được chọn
      drawTreemap(data4, "#chart4", selectedBrand);
    });


  </script>


</body>

</html>"